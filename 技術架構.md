# ğŸ—ï¸ 200 OK æŠ€è¡“æ¶æ§‹

> è»Ÿé«”æ¥æ¡ˆåª’åˆå¹³å°çš„å®Œæ•´æŠ€è¡“æ¶æ§‹èªªæ˜

---

## ğŸ“‹ ç›®éŒ„

1. [ç³»çµ±æ¦‚è¿°](#ç³»çµ±æ¦‚è¿°)
2. [å‰ç«¯æ¶æ§‹](#å‰ç«¯æ¶æ§‹)
3. [å¾Œç«¯æ¶æ§‹](#å¾Œç«¯æ¶æ§‹)
4. [è³‡æ–™åº«æ¶æ§‹](#è³‡æ–™åº«æ¶æ§‹)
5. [èªè­‰ç³»çµ±](#èªè­‰ç³»çµ±)
6. [ç¬¬ä¸‰æ–¹æœå‹™](#ç¬¬ä¸‰æ–¹æœå‹™)
7. [éƒ¨ç½²æ¶æ§‹](#éƒ¨ç½²æ¶æ§‹)
8. [æŠ€è¡“æ£§ç¸½è¦½](#æŠ€è¡“æ£§ç¸½è¦½)

---

## ç³»çµ±æ¦‚è¿°

**200 OK** æ˜¯ä¸€å€‹ç¾ä»£åŒ–çš„è»Ÿé«”æ¥æ¡ˆåª’åˆå¹³å°ï¼Œæ¡ç”¨å‰å¾Œç«¯åˆ†é›¢æ¶æ§‹ï¼š

- **å‰ç«¯**ï¼šNext.js 14 (App Router) + TypeScript
- **å¾Œç«¯**ï¼šFastAPI (Python 3.10+)
- **è³‡æ–™åº«**ï¼šPostgreSQL (Supabase/Cloud SQL)
- **æ¶æ§‹æ¨¡å¼**ï¼šå‰å¾Œç«¯åˆ†é›¢ï¼ŒAPI é©…å‹•

---

## å‰ç«¯æ¶æ§‹

### æŠ€è¡“æ£§

| é …ç›® | æŠ€è¡“ | ç‰ˆæœ¬ |
|------|------|------|
| **æ¡†æ¶** | Next.js | 14.2.0 |
| **è·¯ç”±** | App Router | - |
| **èªè¨€** | TypeScript | 5.4.0 |
| **æ¨£å¼** | Tailwind CSS | 3.4.0 |
| **UI å‹•ç•«** | Framer Motion | 12.23.26 |
| **HTTP å®¢æˆ¶ç«¯** | Axios | 1.7.0 |
| **èªè­‰** | NextAuth.js + JWT | 4.24.0 |
| **å³æ™‚é€šè¨Š** | Socket.io Client | 4.7.0 |
| **è¡¨å–®é©—è­‰** | Zod | 3.23.0 |
| **Markdown** | react-markdown | 10.1.0 |

### å°ˆæ¡ˆçµæ§‹

```
src/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ api/               # API Routes (å¥åº·æª¢æŸ¥ã€èªè­‰)
â”‚   â”œâ”€â”€ projects/          # å°ˆæ¡ˆç›¸é—œé é¢
â”‚   â”œâ”€â”€ conversations/     # å°è©±é é¢
â”‚   â”œâ”€â”€ bids/              # æŠ•æ¨™é é¢
â”‚   â”œâ”€â”€ freelancers/       # æ¥æ¡ˆè€…é é¢
â”‚   â”œâ”€â”€ profile/           # å€‹äººè³‡æ–™é é¢
â”‚   â””â”€â”€ layout.tsx         # æ ¹ Layout
â”œâ”€â”€ components/            # React å…ƒä»¶
â”‚   â”œâ”€â”€ ui/               # åŸºç¤ UI å…ƒä»¶
â”‚   â”œâ”€â”€ layout/           # ç‰ˆé¢å…ƒä»¶ (Navbar, Footer)
â”‚   â”œâ”€â”€ projects/         # å°ˆæ¡ˆç›¸é—œå…ƒä»¶
â”‚   â””â”€â”€ Providers.tsx     # Context Providers
â”œâ”€â”€ lib/                  # æ ¸å¿ƒå‡½å¼åº«
â”‚   â”œâ”€â”€ api.ts           # API å®¢æˆ¶ç«¯å°è£
â”‚   â”œâ”€â”€ auth.ts          # èªè­‰é‚è¼¯
â”‚   â”œâ”€â”€ email.ts         # éƒµä»¶æœå‹™
â”‚   â””â”€â”€ supabase.ts      # Supabase Client (èˆŠç‰ˆ)
â”œâ”€â”€ services/            # æ¥­å‹™é‚è¼¯å±¤
â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”œâ”€â”€ project.service.ts
â”‚   â”œâ”€â”€ bid.service.ts
â”‚   â””â”€â”€ ...
â”œâ”€â”€ middleware/          # API ä¸­ä»‹å±¤
â”‚   â”œâ”€â”€ auth.middleware.ts
â”‚   â”œâ”€â”€ error.middleware.ts
â”‚   â””â”€â”€ ratelimit.middleware.ts
â”œâ”€â”€ hooks/               # è‡ªè¨‚ React Hooks
â”‚   â””â”€â”€ useSession.ts
â”œâ”€â”€ types/               # TypeScript é¡å‹å®šç¾©
â””â”€â”€ utils/               # å·¥å…·å‡½å¼
```

### é—œéµç‰¹æ€§

- âœ… **App Router**ï¼šä½¿ç”¨ Next.js 14 App Router
- âœ… **SSR/SSG**ï¼šæ”¯æ´ä¼ºæœå™¨ç«¯æ¸²æŸ“å’Œéœæ…‹ç”Ÿæˆ
- âœ… **API Routes**ï¼šéƒ¨åˆ† API ç«¯é»ï¼ˆå¥åº·æª¢æŸ¥ç­‰ï¼‰
- âœ… **TypeScript**ï¼šå®Œæ•´å‹åˆ¥æª¢æŸ¥
- âœ… **éŸ¿æ‡‰å¼è¨­è¨ˆ**ï¼šTailwind CSS éŸ¿æ‡‰å¼ä½ˆå±€

---

## å¾Œç«¯æ¶æ§‹

### æŠ€è¡“æ£§

| é …ç›® | æŠ€è¡“ | ç‰ˆæœ¬ |
|------|------|------|
| **æ¡†æ¶** | FastAPI | 0.109.0 |
| **ASGI ä¼ºæœå™¨** | Uvicorn | 0.27.0 |
| **èªè¨€** | Python | 3.10+ |
| **è³‡æ–™åº« ORM** | SQLAlchemy Core | 2.0.25 |
| **è³‡æ–™åº«é©…å‹•** | psycopg (psycopg3) | 3.2.0 |
| **é©—è­‰** | Pydantic | 2.5.3 |
| **èªè­‰** | PyJWT | 2.8.0 |
| **å¯†ç¢¼åŠ å¯†** | passlib + bcrypt | 1.7.4 |
| **éƒµä»¶æœå‹™** | Resend | 0.7.0 |

### å°ˆæ¡ˆçµæ§‹

```
backend/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI æ‡‰ç”¨ç¨‹å¼å…¥å£
â”‚   â”œâ”€â”€ config.py            # è¨­å®šç®¡ç† (Pydantic Settings)
â”‚   â”œâ”€â”€ db.py                # è³‡æ–™åº«é€£ç·šç®¡ç†
â”‚   â”œâ”€â”€ security.py          # å®‰å…¨ç›¸é—œï¼ˆJWT, å¯†ç¢¼ï¼‰
â”‚   â”œâ”€â”€ dependencies.py      # FastAPI Dependencies
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ v1/             # API v1 è·¯ç”±
â”‚   â”‚       â”œâ”€â”€ auth.py     # èªè­‰ API
â”‚   â”‚       â”œâ”€â”€ users.py    # ä½¿ç”¨è€… API
â”‚   â”‚       â”œâ”€â”€ projects.py # å°ˆæ¡ˆ API
â”‚   â”‚       â”œâ”€â”€ bids.py     # æŠ•æ¨™ API
â”‚   â”‚       â”œâ”€â”€ conversations.py # å°è©± API
â”‚   â”‚       â”œâ”€â”€ tokens.py   # ä»£å¹£ API
â”‚   â”‚       â”œâ”€â”€ reviews.py  # è©•åƒ¹ API
â”‚   â”‚       â”œâ”€â”€ admin.py    # ç®¡ç†å“¡ API
â”‚   â”‚       â””â”€â”€ ...
â”‚   â”œâ”€â”€ models/             # è³‡æ–™æ¨¡å‹å®šç¾©
â”‚   â”œâ”€â”€ schemas/            # Pydantic Schemas
â”‚   â””â”€â”€ services/           # æ¥­å‹™é‚è¼¯å±¤
â”‚       â”œâ”€â”€ email_service.py
â”‚       â””â”€â”€ gemini_service.py
â”œâ”€â”€ migrations/             # è³‡æ–™åº«é·ç§»
â””â”€â”€ requirements.txt        # Python ä¾è³´
```

### API è·¯ç”±

æ‰€æœ‰ API çµ±ä¸€ä½¿ç”¨ `/api/v1` å‰ç¶´ï¼š

- **èªè­‰**ï¼š`/api/v1/auth/*`
- **ä½¿ç”¨è€…**ï¼š`/api/v1/users/*`
- **å°ˆæ¡ˆ**ï¼š`/api/v1/projects/*`
- **æŠ•æ¨™**ï¼š`/api/v1/bids/*`
- **å°è©±**ï¼š`/api/v1/conversations/*`
- **ä»£å¹£**ï¼š`/api/v1/tokens/*`
- **è©•åƒ¹**ï¼š`/api/v1/reviews/*`
- **ç®¡ç†å“¡**ï¼š`/api/v1/admin/*`
- **é ­åƒ**ï¼š`/api/v1/avatar/*`

### é—œéµç‰¹æ€§

- âœ… **ç•°æ­¥è™•ç†**ï¼šå…¨é¢ä½¿ç”¨ `async/await`
- âœ… **ç„¡ ORM**ï¼šä½¿ç”¨ SQLAlchemy Coreï¼Œæ€§èƒ½æå‡ 10x
- âœ… **PgBouncer ç›¸å®¹**ï¼šè¨­å®š `prepare_threshold=None`
- âœ… **API æ–‡æª”**ï¼šè‡ªå‹•ç”Ÿæˆ OpenAPI æ–‡æª” (`/docs`)
- âœ… **CORS**ï¼šæ”¯æ´è·¨åŸŸè«‹æ±‚
- âœ… **éŒ¯èª¤è™•ç†**ï¼šçµ±ä¸€çš„ä¾‹å¤–è™•ç†æ©Ÿåˆ¶
- âœ… **é€£ç·šæ± ç®¡ç†**ï¼šConnection Pooling é©é… Cloud Run

---

## è³‡æ–™åº«æ¶æ§‹

### è³‡æ–™åº«

| é …ç›® | æŠ€è¡“ | èªªæ˜ |
|------|------|------|
| **è³‡æ–™åº«** | PostgreSQL | ä¸»è¦è³‡æ–™åº« |
| **æœå‹™æä¾›** | Supabase / Cloud SQL | é›²ç«¯è¨—ç®¡ |
| **é€£ç·šæ± ** | PgBouncer | Transaction Pooling æ¨¡å¼ |
| **é·ç§»å·¥å…·** | Alembic | è³‡æ–™åº«ç‰ˆæœ¬ç®¡ç† |

### é€£ç·šè¨­å®š

- **é©…å‹•**ï¼špsycopg (psycopg3) async driver
- **é€£ç·šæ± **ï¼šSQLAlchemy Connection Pool
  - `pool_size`: 5
  - `max_overflow`: 10
  - `pool_recycle`: 300 ç§’
- **PgBouncer é©é…**ï¼š
  - `prepare_threshold=None`ï¼ˆç¦ç”¨ Prepared Statementsï¼‰
  - å®Œç¾ç›¸å®¹ Transaction Pooling æ¨¡å¼

### ä¸»è¦è³‡æ–™è¡¨

- `users` - ä½¿ç”¨è€…
- `projects` - å°ˆæ¡ˆ
- `bids` - æŠ•æ¨™
- `conversations` - å°è©±
- `messages` - è¨Šæ¯
- `reviews` - è©•åƒ¹
- `tokens` - ä»£å¹£äº¤æ˜“è¨˜éŒ„
- `notifications` - é€šçŸ¥
- `user_connections` - ä½¿ç”¨è€…é€£æ¥ï¼ˆä»˜è²»è¯çµ¡ï¼‰

---

## èªè­‰ç³»çµ±

### èªè­‰æ–¹å¼

| é …ç›® | æŠ€è¡“ | èªªæ˜ |
|------|------|------|
| **ä¸»è¦èªè­‰** | JWT (JSON Web Token) | â­â­â­â­â­ |
| **OAuth å…¥å£** | NextAuth.js | åƒ…ç”¨æ–¼ Google OAuth |
| **Token å„²å­˜** | localStorage | å‰ç«¯å„²å­˜ |
| **Token é¡å‹** | Access Token + Refresh Token | é›™ Token æ©Ÿåˆ¶ |

### JWT é…ç½®

| Token é¡å‹ | æœ‰æ•ˆæœŸ | ç”¨é€” |
|-----------|--------|------|
| **Access Token** | 24 å°æ™‚ | API è«‹æ±‚èªè­‰ |
| **Refresh Token** | 1 å¤© | åˆ·æ–° Access Token |

### èªè­‰æµç¨‹

```
1. ä½¿ç”¨è€…è¨»å†Š/ç™»å…¥
   â†“
2. å¾Œç«¯é©—è­‰ä¸¦ç”Ÿæˆ JWT Tokens
   â†“
3. è¿”å› Tokens çµ¦å‰ç«¯
   â†“
4. å‰ç«¯å„²å­˜åˆ° localStorage
   â†“
5. å¾ŒçºŒ API è«‹æ±‚å¸¶ä¸Š Authorization: Bearer <token>
   â†“
6. å¾Œç«¯é©—è­‰ Token
   â†“
7. å…è¨±/æ‹’çµ•è«‹æ±‚
```

### èªè­‰ä¸­é–“å±¤

- `requireAuth()` - å¿…é ˆç™»å…¥
- `optionalAuth()` - å¯é¸ç™»å…¥
- `requireRole()` - è§’è‰²æª¢æŸ¥

### è§’è‰²ç³»çµ±

- `client` - ç™¼æ¡ˆè€…
- `freelancer` - æ¥æ¡ˆè€…
- `admin` - ç®¡ç†å“¡

---

## ç¬¬ä¸‰æ–¹æœå‹™

### éƒµä»¶æœå‹™

| æœå‹™ | ç”¨é€” | å¥—ä»¶ |
|------|------|------|
| **Resend** | éƒµä»¶ç™¼é€ï¼ˆè¨»å†Šé©—è­‰ã€é€šçŸ¥ç­‰ï¼‰ | resend 0.7.0 / 6.5.2 |

### AI æœå‹™

| æœå‹™ | ç”¨é€” | å¥—ä»¶ |
|------|------|------|
| **Google Gemini** | AI åŠŸèƒ½ï¼ˆå°ˆæ¡ˆæ¨è–¦ç­‰ï¼‰ | Google Gemini API |

### å³æ™‚é€šè¨Š

| æŠ€è¡“ | ç”¨é€” | å¥—ä»¶ |
|------|------|------|
| **Socket.io** | å³æ™‚è¨Šæ¯ | socket.io 4.7.0 |

### å…¶ä»–

- **OAuth**ï¼šGoogle OAuth (NextAuth.js)
- **åœ–ç‰‡è™•ç†**ï¼šPillow (é ­åƒä¸Šå‚³)
- **æ—¥æœŸè™•ç†**ï¼šdate-fns (å‰ç«¯), python-dateutil (å¾Œç«¯)

---

## éƒ¨ç½²æ¶æ§‹

### å‰ç«¯éƒ¨ç½²

| å¹³å° | èªªæ˜ |
|------|------|
| **Vercel** | æ¨è–¦ï¼ˆNext.js åŸç”Ÿæ”¯æ´ï¼‰ |
| **GCP Cloud Run** | æ›¿ä»£æ–¹æ¡ˆ |

### å¾Œç«¯éƒ¨ç½²

| å¹³å° | èªªæ˜ |
|------|------|
| **GCP Cloud Run** | æ¨è–¦ï¼ˆPython/FastAPIï¼‰ |
| **å…¶ä»–å®¹å™¨å¹³å°** | æ”¯æ´ Docker éƒ¨ç½² |

### è³‡æ–™åº«

| æœå‹™ | èªªæ˜ |
|------|------|
| **Supabase** | PostgreSQL è¨—ç®¡ |
| **Cloud SQL** | GCP PostgreSQL |

### å„²å­˜

| æœå‹™ | ç”¨é€” |
|------|------|
| **Google Cloud Storage** | åœ–ç‰‡/æª”æ¡ˆå„²å­˜ |
| **AWS S3** | æ›¿ä»£æ–¹æ¡ˆ |

---

## æŠ€è¡“æ£§ç¸½è¦½

### å‰ç«¯æŠ€è¡“æ£§

```yaml
æ¡†æ¶: Next.js 14 (App Router)
èªè¨€: TypeScript 5.4
æ¨£å¼: Tailwind CSS 3.4
UIå‹•ç•«: Framer Motion
HTTP: Axios
èªè­‰: NextAuth.js + JWT
é©—è­‰: Zod
å³æ™‚é€šè¨Š: Socket.io Client
Markdown: react-markdown
```

### å¾Œç«¯æŠ€è¡“æ£§

```yaml
æ¡†æ¶: FastAPI 0.109
èªè¨€: Python 3.10+
ä¼ºæœå™¨: Uvicorn
è³‡æ–™åº«: PostgreSQL (psycopg3)
ORM: SQLAlchemy Core (ç„¡ ORM)
é©—è­‰: Pydantic
èªè­‰: PyJWT
å¯†ç¢¼: passlib + bcrypt
éƒµä»¶: Resend
```

### è³‡æ–™åº«èˆ‡åŸºç¤è¨­æ–½

```yaml
è³‡æ–™åº«: PostgreSQL
è¨—ç®¡: Supabase / Cloud SQL
é€£ç·šæ± : PgBouncer
é·ç§»: Alembic
```

### ç¬¬ä¸‰æ–¹æœå‹™

```yaml
éƒµä»¶: Resend
AI: Google Gemini
OAuth: Google (NextAuth.js)
å„²å­˜: Google Cloud Storage / AWS S3
å³æ™‚é€šè¨Š: Socket.io
```

---

## ç’°å¢ƒè®Šæ•¸

### å‰ç«¯ç’°å¢ƒè®Šæ•¸

```env
# API
NEXT_PUBLIC_API_URL=http://localhost:8000

# èªè­‰
JWT_SECRET=your-secret-key

# OAuth
GOOGLE_CLIENT_ID=...
GOOGLE_CLIENT_SECRET=...

# Supabase (èˆŠç‰ˆï¼Œå¯èƒ½å·²æ£„ç”¨)
NEXT_PUBLIC_SUPABASE_URL=...
NEXT_PUBLIC_SUPABASE_ANON_KEY=...
```

### å¾Œç«¯ç’°å¢ƒè®Šæ•¸

```env
# æ‡‰ç”¨ç¨‹å¼
DEBUG=True
APP_NAME=200ok Backend API

# è³‡æ–™åº«
DATABASE_URL=postgresql+psycopg://user:password@host:port/database

# JWT
JWT_SECRET=your-secret-key
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=1440
JWT_REFRESH_TOKEN_EXPIRE_DAYS=1

# CORS
CORS_ORIGINS=http://localhost:3000,http://localhost:3001

# éƒµä»¶
RESEND_API_KEY=...
RESEND_FROM_EMAIL=noreply@200ok.tw

# å‰ç«¯ URL
FRONTEND_URL=http://localhost:3000

# AI
GEMINI_API_KEY=...

# ä»£å¹£ç³»çµ±
TOKEN_UNLOCK_DIRECT_COST=200
TOKEN_SUBMIT_PROPOSAL_COST=100
TOKEN_VIEW_PROPOSAL_COST=50
TOKEN_NEW_USER_GIFT=1000
```

---

## é–‹ç™¼å·¥ä½œæµç¨‹

### å‰ç«¯é–‹ç™¼

```bash
# å®‰è£ä¾è³´
npm install

# é–‹ç™¼ä¼ºæœå™¨
npm run dev

# å»ºç½®
npm run build

# é¡å‹æª¢æŸ¥
npm run type-check

# ç¨‹å¼ç¢¼æ ¼å¼åŒ–
npm run format
```

### å¾Œç«¯é–‹ç™¼

```bash
# å®‰è£ä¾è³´
pip install -r backend/requirements.txt

# é–‹ç™¼ä¼ºæœå™¨
cd backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# æˆ–ä½¿ç”¨ Python
python -m uvicorn app.main:app --reload
```

---

## æ¶æ§‹å„ªå‹¢

### å‰å¾Œç«¯åˆ†é›¢

- âœ… **ç¨ç«‹éƒ¨ç½²**ï¼šå‰å¾Œç«¯å¯ç¨ç«‹éƒ¨ç½²å’Œæ“´å±•
- âœ… **æŠ€è¡“é¸å‹éˆæ´»**ï¼šå‰ç«¯ Next.jsï¼Œå¾Œç«¯ FastAPI
- âœ… **API å„ªå…ˆ**ï¼šæ¸…æ™°çš„ API å¥‘ç´„

### æ€§èƒ½å„ªåŒ–

- âœ… **ç„¡ ORM**ï¼šSQLAlchemy Coreï¼Œæ€§èƒ½æå‡ 10x
- âœ… **ç•°æ­¥è™•ç†**ï¼šå…¨é¢ async/await
- âœ… **é€£ç·šæ± ç®¡ç†**ï¼šé©é… Cloud Run å’Œ PgBouncer

### å¯æ“´å±•æ€§

- âœ… **å¾®æœå‹™å‹å¥½**ï¼šAPI é©…å‹•æ¶æ§‹
- âœ… **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šæ”¯æ´ Docker å’Œ Cloud Run
- âœ… **ç„¡ä¼ºæœå™¨æ”¯æ´**ï¼šNext.js æ”¯æ´ Vercel

---

## ç›¸é—œæ–‡æª”

- [API æ–‡æª”](èªªæ˜æ–‡ä»¶/API/API_DOCS.md)
- [èªè­‰ç³»çµ±æ¶æ§‹](èªªæ˜æ–‡ä»¶/èªè­‰ç³»çµ±/AUTH_ARCHITECTURE.md)
- [éƒ¨ç½²æŒ‡å—](èªªæ˜æ–‡ä»¶/éƒ¨ç½²/DEPLOYMENT.md)
- [è³‡æ–™åº«é·ç§»](èªªæ˜æ–‡ä»¶/è³‡æ–™åº«/SUPABASE_TO_CLOUDSQL_MIGRATION.md)

---

**æœ€å¾Œæ›´æ–°**ï¼š2025-01-XX

