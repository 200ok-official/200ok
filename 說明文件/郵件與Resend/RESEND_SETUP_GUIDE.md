# Resend éƒµä»¶æœå‹™å®Œæ•´è¨­å®šæŒ‡å—

## âœ… å·²å®Œæˆçš„å¯¦ä½œ

### 1. å®‰è£èˆ‡æ•´åˆ
- âœ… å®‰è£ `resend` å¥—ä»¶
- âœ… å»ºç«‹éƒµä»¶æœå‹™æ¨¡çµ„ (`src/lib/email.ts`)
- âœ… æ•´åˆåˆ° `AuthService`
- âœ… å¯¦ä½œé‡ç™¼é™åˆ¶æ©Ÿåˆ¶ï¼ˆ2åˆ†é˜å†·å»æ™‚é–“ï¼‰

### 2. éƒµä»¶æ¨¡æ¿
- âœ… ç²¾ç¾çš„ HTML é©—è­‰éƒµä»¶æ¨¡æ¿
- âœ… å¯†ç¢¼é‡è¨­éƒµä»¶æ¨¡æ¿ï¼ˆé ç•™åŠŸèƒ½ï¼‰
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´å„ç¨®éƒµä»¶å®¢æˆ¶ç«¯

### 3. é‡ç™¼é™åˆ¶
- âœ… åŸºæ–¼è³‡æ–™åº«çš„é€Ÿç‡é™åˆ¶
- âœ… 2 åˆ†é˜å†·å»æ™‚é–“
- âœ… å‹å–„çš„éŒ¯èª¤æç¤º

---

## ğŸš€ è¨­å®šæ­¥é©Ÿ

### Step 1: è¨»å†Š Resend å¸³è™Ÿ

1. å‰å¾€ [https://resend.com](https://resend.com)
2. é»æ“Šã€ŒGet Startedã€è¨»å†Šå¸³è™Ÿ
3. å®Œæˆä¿¡ç®±é©—è­‰

### Step 2: å–å¾— API Key

1. ç™»å…¥ Resend Dashboard
2. å‰å¾€ **API Keys** é é¢
3. é»æ“Šã€ŒCreate API Keyã€
4. å¡«å¯«åç¨±ï¼ˆä¾‹å¦‚ï¼š`200ok-production`ï¼‰
5. è¤‡è£½ç”Ÿæˆçš„ API Keyï¼ˆæ ¼å¼ï¼š`re_xxxxxxxxxxxxxxxxxxxxxxxxxx`ï¼‰

âš ï¸ **é‡è¦**ï¼šAPI Key åªæœƒé¡¯ç¤ºä¸€æ¬¡ï¼Œè«‹å¦¥å–„ä¿å­˜ï¼

### Step 3: è¨­å®šç’°å¢ƒè®Šæ•¸

åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„çš„ `.env.local` æª”æ¡ˆä¸­æ–°å¢ï¼š

```env
# Resend éƒµä»¶æœå‹™
RESEND_API_KEY=re_xxxxxxxxxxxxxxxxxxxxxxxxxx
EMAIL_FROM=200 OK <onboarding@resend.dev>

# æ‡‰ç”¨ç¨‹å¼ URLï¼ˆç”¨æ–¼ç”Ÿæˆé©—è­‰é€£çµï¼‰
NEXT_PUBLIC_APP_URL=http://localhost:3000
```

### Step 4: é©—è­‰åŸŸåï¼ˆå¯é¸ï¼Œä½†å»ºè­°ï¼‰

#### å…è²»é–‹ç™¼ç’°å¢ƒ
Resend æä¾›å…è²»çš„ `onboarding@resend.dev` æ¸¬è©¦ä¿¡ç®±ï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼Œä½†ï¼š
- âš ï¸ åªèƒ½ç™¼é€åˆ°è¨»å†Š Resend å¸³è™Ÿçš„ä¿¡ç®±
- âš ï¸ ä¸é©åˆç”Ÿç”¢ç’°å¢ƒ

#### è¨­å®šè‡ªè¨‚åŸŸåï¼ˆç”Ÿç”¢ç’°å¢ƒå¿…è¦ï¼‰

1. å‰å¾€ Resend Dashboard > **Domains**
2. é»æ“Šã€ŒAdd Domainã€
3. è¼¸å…¥æ‚¨çš„åŸŸåï¼ˆä¾‹å¦‚ï¼š`200ok.com`ï¼‰
4. è¤‡è£½æä¾›çš„ DNS è¨˜éŒ„
5. å‰å¾€æ‚¨çš„ DNS æœå‹™å•†ï¼ˆå¦‚ Cloudflare, Namecheapï¼‰
6. æ–°å¢ä»¥ä¸‹ DNS è¨˜éŒ„ï¼š

   | é¡å‹ | åç¨± | å€¼ | TTL |
   |------|------|-----|-----|
   | TXT | @ | `resend-verification=xxxxx` | è‡ªå‹• |
   | MX | @ | `feedback-smtp.resend.com` | 10 |
   | TXT | `resend._domainkey` | `p=MIGfMA0GC...` | è‡ªå‹• |

7. ç­‰å¾… DNS å‚³æ’­ï¼ˆé€šå¸¸ 5-30 åˆ†é˜ï¼‰
8. å›åˆ° Resend é»æ“Šã€ŒVerify Domainã€

#### é©—è­‰æˆåŠŸå¾Œï¼Œæ›´æ–°ç’°å¢ƒè®Šæ•¸ï¼š

```env
EMAIL_FROM=200 OK <noreply@200ok.com>
```

---

## ğŸ§ª æ¸¬è©¦éƒµä»¶åŠŸèƒ½

### æ¸¬è©¦é–‹ç™¼ç’°å¢ƒ

1. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ï¼š
   ```bash
   npm run dev
   ```

2. å‰å¾€è¨»å†Šé é¢ï¼š
   ```
   http://localhost:3000/register
   ```

3. ä½¿ç”¨æ‚¨è¨»å†Š Resend çš„ä¿¡ç®±è¨»å†Šå¸³è™Ÿ

4. æª¢æŸ¥ä¿¡ç®±æ”¶ä»¶åŒ£ï¼ˆæˆ–åƒåœ¾éƒµä»¶ï¼‰

5. é»æ“Šé©—è­‰é€£çµ

### æª¢æŸ¥ Resend Dashboard

1. å‰å¾€ **Emails** é é¢
2. æŸ¥çœ‹å·²ç™¼é€çš„éƒµä»¶
3. æª¢æŸ¥ç™¼é€ç‹€æ…‹ï¼š
   - âœ… **Delivered**: æˆåŠŸé€é”
   - ğŸ”„ **Queued**: ä½‡åˆ—ä¸­
   - âŒ **Bounced**: è¢«é€€å›
   - âš ï¸ **Complained**: è¢«æ¨™è¨˜ç‚ºåƒåœ¾éƒµä»¶

---

## ğŸ¨ éƒµä»¶æ¨¡æ¿é è¦½

### é©—è­‰éƒµä»¶æ¨¡æ¿

```html
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>é©—è­‰æ‚¨çš„ 200 OK å¸³è™Ÿ</title>
</head>
<body style="background-color: #f5f3ed;">
  <!-- ç²¾ç¾çš„ HTML æ¨¡æ¿ -->
  <!-- åŒ…å«ï¼šå“ç‰Œæ¨™é¡Œã€é©—è­‰æŒ‰éˆ•ã€å‚™ç”¨é€£çµã€æ³¨æ„äº‹é … -->
</body>
</html>
```

ç‰¹è‰²ï¼š
- âœ… éŸ¿æ‡‰å¼è¨­è¨ˆ
- âœ… å“ç‰Œè‰²å½© (#20263e, #c5ae8c)
- âœ… æ¸…æ¥šçš„ CTA æŒ‰éˆ•
- âœ… å‚™ç”¨æ–‡å­—é€£çµ
- âœ… å®‰å…¨æé†’
- âœ… æ”¯æ´æ·±è‰²æ¨¡å¼

---

## ğŸ›¡ï¸ é‡ç™¼é™åˆ¶æ©Ÿåˆ¶

### é™åˆ¶è¦å‰‡

- **å†·å»æ™‚é–“**ï¼š2 åˆ†é˜
- **æª¢æŸ¥æ–¹å¼**ï¼šæŸ¥è©¢è³‡æ–™åº«æœ€è¿‘çš„ token å»ºç«‹æ™‚é–“
- **éŒ¯èª¤æç¤º**ï¼šã€Œè«‹ç¨å¾Œå†è©¦ï¼Œæ‚¨å¯ä»¥åœ¨ XX ç§’å¾Œé‡æ–°ç™¼é€é©—è­‰éƒµä»¶ã€

### å¯¦ä½œåŸç†

```typescript
// æª¢æŸ¥æœ€è¿‘çš„ token å»ºç«‹æ™‚é–“
const { data: recentToken } = await this.db
  .from("email_verification_tokens")
  .select("created_at")
  .eq("user_id", user.id)
  .order("created_at", { ascending: false })
  .limit(1)
  .single();

if (recentToken) {
  const lastSentTime = new Date(recentToken.created_at).getTime();
  const now = Date.now();
  const timeDiff = now - lastSentTime;
  const cooldownMinutes = 2;
  const cooldownMs = cooldownMinutes * 60 * 1000;

  if (timeDiff < cooldownMs) {
    const remainingSeconds = Math.ceil((cooldownMs - timeDiff) / 1000);
    return {
      success: false,
      message: `è«‹ç¨å¾Œå†è©¦ï¼Œæ‚¨å¯ä»¥åœ¨ ${remainingSeconds} ç§’å¾Œé‡æ–°ç™¼é€é©—è­‰éƒµä»¶`,
    };
  }
}
```

### å„ªé»
- âœ… é˜²æ­¢æ¿«ç”¨
- âœ… æ¸›å°‘ API è²»ç”¨
- âœ… é¿å…è¢«æ¨™è¨˜ç‚ºåƒåœ¾éƒµä»¶
- âœ… ä¸éœ€è¦é¡å¤–çš„ Redis æœå‹™

### èª¿æ•´å†·å»æ™‚é–“

å¦‚éœ€ä¿®æ”¹å†·å»æ™‚é–“ï¼Œç·¨è¼¯ `src/services/auth.service.ts`ï¼š

```typescript
const cooldownMinutes = 2; // æ”¹ç‚ºæ‚¨æƒ³è¦çš„åˆ†é˜æ•¸
```

---

## ğŸ“Š Resend å®šåƒ¹æ–¹æ¡ˆ

### å…è²»æ–¹æ¡ˆ
- âœ… æ¯æœˆ 3,000 å°éƒµä»¶
- âœ… 100 å€‹æ”¶ä»¶äºº/å¤©
- âœ… 1 å€‹è‡ªè¨‚åŸŸå
- âœ… åŸºæœ¬åˆ†æ

### ä»˜è²»æ–¹æ¡ˆ
- **Pro**: $20/æœˆ
  - 50,000 å°éƒµä»¶/æœˆ
  - ç„¡æ¯æ—¥é™åˆ¶
  - 3 å€‹è‡ªè¨‚åŸŸå
  - é€²éšåˆ†æ

- **ä¼æ¥­æ–¹æ¡ˆ**: è¯çµ¡éŠ·å”®
  - ç„¡é™éƒµä»¶
  - å°ˆå±¬æ”¯æ´

è©³ç´°å®šåƒ¹ï¼š[https://resend.com/pricing](https://resend.com/pricing)

---

## ğŸ”§ å¸¸è¦‹å•é¡Œ

### Q1: ç‚ºä»€éº¼æˆ‘æ”¶ä¸åˆ°éƒµä»¶ï¼Ÿ

**æª¢æŸ¥æ¸…å–®**ï¼š
1. âœ… API Key æ˜¯å¦æ­£ç¢ºè¨­å®š
2. âœ… `EMAIL_FROM` æ ¼å¼æ˜¯å¦æ­£ç¢º
3. âœ… æª¢æŸ¥åƒåœ¾éƒµä»¶è³‡æ–™å¤¾
4. âœ… å‰å¾€ Resend Dashboard æŸ¥çœ‹éƒµä»¶ç‹€æ…‹
5. âœ… ç¢ºèªæ”¶ä»¶ä¿¡ç®±æ˜¯å¦æ­£ç¢º
6. âœ… æª¢æŸ¥ Server Logs æ˜¯å¦æœ‰éŒ¯èª¤

### Q2: éƒµä»¶é€²å…¥åƒåœ¾éƒµä»¶è³‡æ–™å¤¾

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- âœ… é©—è­‰è‡ªè¨‚åŸŸåï¼ˆè¨­å®š SPF, DKIM, DMARCï¼‰
- âœ… é¿å…é »ç¹ç™¼é€
- âœ… ä½¿ç”¨å°ˆæ¥­çš„ä¿¡ç®±åœ°å€ï¼ˆnoreply@yourdomain.comï¼‰
- âœ… æä¾›æ¸…æ¥šçš„é€€è¨‚é€£çµ

### Q3: å¦‚ä½•ç›£æ§éƒµä»¶ç™¼é€ç‹€æ…‹ï¼Ÿ

1. å‰å¾€ Resend Dashboard
2. é»æ“Š **Emails** æŸ¥çœ‹æ‰€æœ‰éƒµä»¶
3. ä½¿ç”¨ Webhook æ¥æ”¶å³æ™‚é€šçŸ¥ï¼š
   ```typescript
   // æœªä¾†å¯å¯¦ä½œ
   POST /api/webhooks/resend
   ```

### Q4: å†·å»æ™‚é–“å¤ªçŸ­/å¤ªé•·æ€éº¼è¾¦ï¼Ÿ

ç·¨è¼¯ `src/services/auth.service.ts` çš„ `cooldownMinutes` è®Šæ•¸ï¼š

```typescript
const cooldownMinutes = 5; // æ”¹ç‚º 5 åˆ†é˜
```

å»ºè­°ç¯„åœï¼š
- **é–‹ç™¼ç’°å¢ƒ**ï¼š1-2 åˆ†é˜
- **ç”Ÿç”¢ç’°å¢ƒ**ï¼š2-5 åˆ†é˜
- **é«˜é¢¨éšªæ“ä½œ**ï¼š5-10 åˆ†é˜

---

## ğŸš€ ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²æª¢æŸ¥æ¸…å–®

- [ ] å·²é©—è­‰è‡ªè¨‚åŸŸå
- [ ] å·²è¨­å®šæ­£ç¢ºçš„ `EMAIL_FROM`
- [ ] å·²è¨­å®š `NEXT_PUBLIC_APP_URL` ç‚ºæ­£å¼åŸŸå
- [ ] å·²è¨­å®š Resend API Keyï¼ˆProductionï¼‰
- [ ] å·²æ¸¬è©¦éƒµä»¶ç™¼é€
- [ ] å·²æª¢æŸ¥éƒµä»¶ä¸é€²åƒåœ¾éƒµä»¶
- [ ] å·²è¨­å®š Webhookï¼ˆé¸ç”¨ï¼‰
- [ ] å·²ç›£æ§ Resend Dashboard
- [ ] å·²å‚™ä»½ API Key

---

## ğŸ“ ç›¸é—œæª”æ¡ˆ

- `src/lib/email.ts` - éƒµä»¶æœå‹™æ¨¡çµ„
- `src/services/auth.service.ts` - èªè­‰æœå‹™ï¼ˆåŒ…å«éƒµä»¶ç™¼é€é‚è¼¯ï¼‰
- `src/app/api/v1/auth/verify-email/route.ts` - é©—è­‰ API ç«¯é»
- `src/app/verify-email/page.tsx` - é©—è­‰é é¢
- `src/app/register/page.tsx` - è¨»å†Šé é¢ï¼ˆå«é‡ç™¼åŠŸèƒ½ï¼‰
- `src/app/profile/page.tsx` - å€‹äººè³‡æ–™é é¢ï¼ˆå«é‡ç™¼åŠŸèƒ½ï¼‰

---

## âœ¨ å¾ŒçºŒæ“´å±•å»ºè­°

- [ ] å¯¦ä½œå¯†ç¢¼é‡è¨­åŠŸèƒ½ï¼ˆæ¨¡æ¿å·²æº–å‚™å¥½ï¼‰
- [ ] æ–°å¢æ­¡è¿éƒµä»¶
- [ ] æ–°å¢æ¡ˆä»¶é€šçŸ¥éƒµä»¶
- [ ] æ–°å¢æŠ•æ¨™é€šçŸ¥éƒµä»¶
- [ ] å¯¦ä½œ Webhook æ¥æ”¶éƒµä»¶äº‹ä»¶
- [ ] æ•´åˆ Redis åšæ›´é€²éšçš„é€Ÿç‡é™åˆ¶
- [ ] æ–°å¢éƒµä»¶æ¨¡æ¿ç®¡ç†ç³»çµ±
- [ ] å¯¦ä½œéƒµä»¶ç™¼é€æ­·å²è¨˜éŒ„
- [ ] æ–°å¢é€€è¨‚åŠŸèƒ½

---

## ğŸ‰ å®Œæˆï¼

ç¾åœ¨æ‚¨çš„ 200 OK å¹³å°å·²ç¶“å…·å‚™ï¼š
- âœ… å®Œæ•´çš„ä¿¡ç®±é©—è­‰åŠŸèƒ½
- âœ… å°ˆæ¥­çš„éƒµä»¶æ¨¡æ¿
- âœ… æ™ºæ…§çš„é‡ç™¼é™åˆ¶
- âœ… ç”Ÿç”¢ç’°å¢ƒå°±ç·’

éœ€è¦å”åŠ©ï¼Ÿè«‹åƒè€ƒï¼š
- [Resend å®˜æ–¹æ–‡ä»¶](https://resend.com/docs)
- [Resend Node.js SDK](https://github.com/resendlabs/resend-node)

